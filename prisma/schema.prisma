generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  user_id String
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  type                String?
  provider            String?
  provider_account_id String?
  refresh_token       String?
  access_token        String?
  expires_at          DateTime?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?

  @@unique([provider, provider_account_id])
  @@map("accounts")
}

enum Restriction_period {
  One_Week
  Two_Weeks
  One_Month
  Three_Months
  Six_Months
  One_Year
  Permanent
}

model User {
  id           String    @id @default(cuid())
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now()) @updatedAt
  deleted_at   DateTime?
  status       Int?      @default(1) @db.SmallInt
  approved_at  DateTime?
  availability String?

  email       String? @unique
  username    String? @unique
  name        String? @db.VarChar(255)
  first_name  String? @db.VarChar(255)
  last_name   String? @db.VarChar(255)
  password    String? @db.VarChar(255)
  domain      String? @unique
  avatar      String?
  grade_level String?

  // Google Authentication Fields
  googleId          String?   @unique // Store Google ID for OAuth
  linkedinId        String?   @unique // Store LinkedIn ID for OAuth
  firstName         String? // First name from Google
  lastName          String? // Last name from Google
  picture           String? // Google profile picture
  accessToken       String? // Google OAuth Access Token
  refreshToken      String? // Google OAuth Refresh Token
  email_verified_at DateTime?

  // LinkedIn Authentication Fields

  // Teacher-specific Fields
  highest_education_level      String?
  teching_experience           String?
  subjects_taught              String[]
  hourly_rate                  Decimal?            @db.Decimal(10, 2)
  about_me                     String?             @db.Text
  general_availability         String?             @db.Text
  certifications               String[]             @db.Text
  is_agreed_terms              Int?                @default(0)
  grades_taught                String[]
  is_verified                  Int?                @default(0)
  is_agree_application_process Int?                @default(0)
  is_accepted                  String?             @default("pending")
  is_restricted                Int?                @default(0)
  restriction_reason           String?             @db.Text
  restriction_period           Restriction_period? @default(Three_Months)

  phone_number  String?
  country       String?
  state         String?
  city          String?
  address       String?
  zip_code      String?
  gender        String?
  date_of_birth DateTime? @db.Date

  // Billing ID (e.g., Stripe customer ID)
  billing_id String?

  type String? @default("user") // Default to "user", can be "admin" or "teacher"

  is_two_factor_enabled Int?    @default(0)
  two_factor_secret     String? // Secret key for two-factor authentication

  // Relationships
  accounts                  Account[]
  creator_conversations     Conversation[]       @relation("creator")
  participant_conversations Conversation[]       @relation("participant")
  receiver_messages         Message[]            @relation("receiver")
  sender_messages           Message[]            @relation("sender")
  receiver_notifications    Notification[]       @relation("receiver")
  sender_notifications      Notification[]       @relation("sender")
  user_payment_methods      UserPaymentMethod[]
  user_settings             UserSetting[]
  ucodes                    Ucode[]
  roles                     Role[]
  role_users                RoleUser[]
  payment_transactions      PaymentTransaction[]
  Create_Session            Create_Session[]
  // Book_Session Book_Session[] @relation("teacher")
  Book_Sessions             Book_Session[]
  Reschedule_Session        Reschedule_Session[]
  Rate_Session              Rate_Session[]
  Reporter                  Report[]             @relation("reporter")
  Reported                  Report[]             @relation("reported")
  HelpAndSupport            HelpAndSupport[]

  @@map("users")
  Blog Blog[]
  TeamMember TeamMember[]
}

model Ucode {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  status     Int?     @default(1) @db.SmallInt

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  token      String?
  email      String?
  expired_at DateTime?

  @@map("ucodes")
}

model Role {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status Int?    @default(1) @db.SmallInt
  title  String?
  name   String?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  permission_roles PermissionRole[]
  role_users       RoleUser[]
  permissions      Permission[]     @relation("PermissionToRole")

  @@map("roles")
}

model Permission {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status     Int?    @default(1) @db.SmallInt
  title      String?
  action     String?
  subject    String?
  conditions String?
  fields     String?

  permission_roles PermissionRole[]
  roles            Role[]           @relation("PermissionToRole")

  @@map("permissions")
}

model PermissionRole {
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  permission_id String
  permission    Permission @relation(fields: [permission_id], references: [id], onDelete: Cascade)

  role_id String
  role    Role   @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@id([permission_id, role_id])
  @@map("permission_roles")
}

model RoleUser {
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  role_id String
  role    Role   @relation(fields: [role_id], references: [id], onDelete: Cascade)

  user_id String
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([role_id, user_id])
  @@map("role_users")
}

// this table stores notification event
model NotificationEvent {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status Int?    @default(1) @db.SmallInt
  type   String?
  text   String?

  notifications Notification[]

  @@map("notification_events")
}

model Notification {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  read_at DateTime?

  status Int? @default(1) @db.SmallInt

  sender_id String?
  sender    User?   @relation("sender", fields: [sender_id], references: [id])

  receiver_id String?
  receiver    User?   @relation("receiver", fields: [receiver_id], references: [id])

  notification_event_id String?
  notification_event    NotificationEvent? @relation(fields: [notification_event_id], references: [id])

  entity_id String?

  @@map("notifications")
}

model UserPaymentMethod {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  payment_method_id String?
  checkout_id       String?

  @@map("user_payment_methods")
}

model PaymentTransaction {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  store_id String?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  order_id         String?
  type             String?  @default("order")
  withdraw_via     String?  @default("wallet")
  provider         String?
  reference_number String?
  status           String?  @default("pending")
  raw_status       String?
  amount           Decimal?
  currency         String?
  paid_amount      Decimal?
  paid_currency    String?

  @@map("payment_transactions")
}

// ---------Start Chat schema---------

enum MessageStatus {
  PENDING
  SENT
  DELIVERED
  READ
}

// message is used for conversation
model Message {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status MessageStatus? @default(PENDING)

  sender_id String?
  sender    User?   @relation("sender", fields: [sender_id], references: [id])

  receiver_id String?
  receiver    User?   @relation("receiver", fields: [receiver_id], references: [id])

  conversation_id String?
  conversation    Conversation? @relation(fields: [conversation_id], references: [id], onDelete: Cascade)

  attachment_id String?
  attachment    Attachment? @relation(fields: [attachment_id], references: [id])

  message String?

  @@map("messages")
}

// this table stores attachment of message
model Attachment {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  name     String?
  type     String?
  size     Int?
  file     String?
  file_alt String?

  messages Message[]

  @@map("attachments")
}

// this table stores conversation
model Conversation {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  creator_id String?
  creator    User?   @relation("creator", fields: [creator_id], references: [id])

  participant_id String?
  participant    User?   @relation("participant", fields: [participant_id], references: [id])

  messages Message[]

  @@map("conversations")
}

// ---------End Chat schema---------

model Faq {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status     Int?    @default(1) @db.SmallInt
  sort_order Int?    @default(0)
  question   String?
  answer     String?

  @@map("faqs")
}

model Contact {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  first_name   String?
  last_name    String?
  email        String?
  phone_number String?
  message      String?

  @@map("contacts")
}

model SocialMedia {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status     Int?    @default(1) @db.SmallInt
  sort_order Int?    @default(0)
  name       String?
  url        String?
  icon       String?

  @@map("social_medias")
}

model WebsiteInfo {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  name                String?
  phone_number        String?
  email               String?
  address             String?
  logo                String?
  favicon             String?
  copyright           String?
  cancellation_policy String?

  @@map("website_infos")
}

model Setting {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  category      String?
  label         String?
  description   String?
  key           String? @unique
  default_value String?

  user_settings UserSetting[]

  @@map("settings")
}

model UserSetting {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  setting_id String?
  setting    Setting? @relation(fields: [setting_id], references: [id])

  value String?

  @@map("user_settings")
}

////////////////////////////////
// student models //////////////
////////////////////////////////

////////////////////////////////
// teacher models //////////////
////////////////////////////////

enum Mode {
  Virtual
  In_Person
}

model Create_Session {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id                       String?
  user                          User?          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  slots_available               String?
  session_type                  String?
  subject                       String?
  status                        String?        @default("active")
  session_charge                String?
  mode                          Mode?          @default(Virtual)
  join_link                     String?
  is_restricted                 Int?           @default(0)
  restriction_reason            String?        @db.Text
  is_started                   Int?           @default(0)
  is_completed                  Int?           @default(0)
  available_slots_time_and_date DateTime[]
  pdf_attachment                String[]
  Book_Session                  Book_Session[]

  @@map("create_sessions")

  Rate_Session Rate_Session[]
}

model Book_Session {
  id                        String               @id @default(cuid())
  created_at                DateTime             @default(now())
  updated_at                DateTime             @default(now())
  deleted_at                DateTime?
  username                  String?
  subject                   String?
  payment_status            String?              @default("pending")
  transaction_id            String?
  user_id                   String?
  user                      User?                @relation(fields: [user_id], references: [id])
  // teacher_id       String?
  // teacher          User?      @relation("teacher", fields: [teacher_id], references: [id])
  create_session_id         String?
  create_session            Create_Session?      @relation(fields: [create_session_id], references: [id])
  session_date              DateTime?
  status                    String?              @default("pending")
  is_cancelled              Int?                 @default(0)
  is_joined                 Int?                 @default(0)
  is_completed              Int?                 @default(0)
  is_request_for_reschedule Int?                 @default(0)
  joined_at                DateTime?             @db.Timestamptz
  started_at               DateTime?             @db.Timestamptz
  ended_at                 DateTime?             @db.Timestamptz
  session_period            String?
  Reschedule_Session        Reschedule_Session[]
  Rate_Session              Rate_Session[]

  @@map("book_sessions")
}

model Reschedule_Session {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  username        String?
  subject         String?
  book_session_id String?
  book_session    Book_Session? @relation(fields: [book_session_id], references: [id])



  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  rescheduled_date DateTime?
  reason           String?
  is_accepted      Int?      @default(0)
  is_rejected      Int?      @default(0)
  join_link        String?
  reject_reason    String?

  @@unique([user_id, book_session_id])
  @@map("reschedule_sessions")
}

////////////////////////////////
// common models ///////////////
////////////////////////////////

model Rate_Session {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  book_session_id String?
  book_session    Book_Session? @relation(fields: [book_session_id], references: [id])

  create_session_id String?
  create_session    Create_Session? @relation(fields: [create_session_id], references: [id])

  rating  Int?
  comment String?

  @@unique([user_id, book_session_id])
  @@map("rate_sessions")
}

model Report {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  reporter_id String?
  reporter    User?   @relation("reporter", fields: [reporter_id], references: [id])

  reported_id String?
  reported    User?   @relation("reported", fields: [reported_id], references: [id])

  reason      String?
  description String?

  @@unique([reporter_id, reported_id])
  @@map("reports")
}

/////////////////////////////////
// Help and support model ///////
/////////////////////////////////

model HelpAndSupport {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  full_name String?
  email     String?
  subject   String?
  message   String? @db.Text
  status    String? @default("unsolved")

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  @@map("help_and_supports")
}

/////////////////////////////////
// website info /////////////////
/////////////////////////////////

enum category {
Teacher
Student
}
model Blog {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  title       String?
  description String? @db.Text
  image       String?
  category    category?


  @@map("blogs")
}
/////////////////////////////////
// add a member /////////////////
/////////////////////////////////

model TeamMember {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  name     String?
  designation String?
  image    String?
  description String? @db.Text
  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  @@map("team_members")
}

model CashOn{
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  name     String?
}
